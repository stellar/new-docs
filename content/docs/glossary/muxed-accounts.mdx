---
title: Muxed Accounts
order:
---

import { Alert } from "components/Alert";
import { CodeExample } from "components/CodeExample";


A **muxed** (or *multiplexed*) **account** is an account that exists "on top of" a traditional Stellar account address. It combines the familiar `GABC...` address with a 64-bit integer ID and can be used to distinguish multiple "virtual" accounts that share an underlying "real" account.

<Alert>

  **Warning**: *This feature is experimental.*
  Muxed accounts are not widely supported yet. Many wallets may not display a muxed account address and instead display the account ID address, ignoring the 64-bit ID. Adoption efforts are actively in progress.

</Alert>

Muxed accounts were defined in [CAP-27](https://stellar.org/protocol/cap-27), introduced in Protocol 13, and their string representation is described in [SEP-23](https://stellar.org/protocol/sep-21). They have their own address format that starts with an `M` prefix. For example, from the account address `GA7QYNF7SOWQ3GLR2BGMZEHXAVIRZA4KVWLTJJFC7MGXUA74P7UJVSGZ`, we can create new muxed accounts with two different IDs:

  - `MA7QYNF7SOWQ3GLR2BGMZEHXAVIRZA4KVWLTJJFC7MGXUA74P7UJUAAAAAAAAAAAACJUQ` has the ID `0`, while 
  - `MA7QYNF7SOWQ3GLR2BGMZEHXAVIRZA4KVWLTJJFC7MGXUA74P7UJUAAAAAAAAAABUTGI4` has the ID `420`.

Both of these addresses, when used with one of the [supported operations][supported-ops], will act on the underlying `GA7Q...` address.

With muxed accounts, we can *natively* support the ecosystem-level abstraction of account memo requirements (see [SEP-29](https://stellar.org/protocol/sep-29)), where transaction memos were often used to distinguish between users backed by a single custodial account. Now, the embedded ID can be used for this distinction, and guides like [this one](../building-apps/setup-custodial-account.mdx) can be made superfluous. In other words, virtual accounts are now a first-class citizen on the network.

There are many other benefits to embedding this abstraction into the protocol:

  - **"Share-ability"**: Rather than worrying about error-prone things like copy-pasting memo IDs, you can just share your `M...` address.
  - **SDK support**: The various [SDKs](../software-and-sdks) support this abstraction natively, letting you create, manage, and work with muxed accounts easily.
  - **Efficiency**: By combining related virtual accounts under a single account's umbrella, you can avoid holding reserves and paying fees for all of them to exist in the ledger individually.

<Alert>

  **Terminology Tip**: The term *muxing* comes from computer networking and telecommunications, where multiple signals are combined into one signal over a shared medium. We are doing the same thing here with muxed accounts: combining multiple "virtual" accounts into a single shared account in the Stellar ledger.

</Alert>

It's worth noting that this feature is intended to be a high-level abstraction, merely embedded into the protocol for convenience and standardization. There's no validation on IDs: as far as the Stellar Network is concerned, all of the [supported operations][supported-ops] operate exactly as if you did not used a muxed account. For example, if you make a payment from two muxed accounts that share an underlying Stellar account (but have different IDs), this is *exactly the same* as that Stellar account sending two payments as far as the ledger is concerned.

It's worth noting that this feature is intended to be a high-level abstraction, embedded into the protocol for convenience and standardization. As far as the Stellar Network is concerned, all of the [supported operations][supported-ops] operate exactly as if you did *not* use a muxed account. For example, if you make a payment from two "sibling" muxed accounts (i.e. muxed accounts sharing an underlying `G...` account but with different IDs), this is *exactly the same* as that Stellar account sending two payments, as far as the ledger is concerned.


## Supporting Opt-In

Because muxed account support is still experimental, you need to **explicitly opt-in** to creating operations with muxed properties. If you do not pass these opt-in flags in the necessary places, SDKs will throw errors. This is done in an effort to ensure that muxed accounts are not "accidentally" working in your application and thus may be misleading to your users.

Each SDK implements this a little differently, but generally-speaking you need to explicitly call out muxing support when creating operations and/or transactions that use muxed accounts.


## Supported Operations

Not all operations can be used with muxed accounts. For example, you cannot set the destination of a [`CreateAccount`](../start/list-of-operations.mdx#create-account) operation to be a muxed account, because only their shared, underlying `G...` account exists in the ledger. However, you can use them with:

  - the source account of *any* operation or [transaction](./transactions.mdx),
  - the destination of all three types of payments:
    * [`Payment`](../start/list-of-operations.mdx#payment),
    * [`PathPaymentStrictSend`](../start/list-of-operations.mdx#path-payment-strict-send), and
    * [`PathPaymentStrictReceive`](../start/list-of-operations.mdx#path-payment-strict-receive)
  - the destination of an [`AccountMerge`](../start/list-of-operations.mdx#account-merge), and
  - the fee source of a [fee-bump transaction](./fee-bumps.mdx).

We'll demonstrate some of these later in the [Examples](#examples).


## Horizon Support

Even though at the end of the day, only the underlying `G...` account _truly_ exists in the Stellar ledger, the [Horizon API](../../api/introduction/) will make some effort to interpret and track the muxed accounts responsible for certain actions.

**TODO.**


## Frequently Asked Questions
**TODO.**

### How do I support it in my wallet?
### Should I support Muxed Accounts in my wallet?
### etc.


## Examples

In this section, we'll demonstrate how to create muxed accounts and how they interact with some of the supported operations. To drive home the fact that custodial account workarounds based on transaction memos are superfluous now, we'll use that as a skeleton for our example structure.


### Preamble
First, let's create two accounts and then a handful of virtual accounts representing "custodial customers" that the parent account manages.

<CodeExample title="Preamble">

```js
const sdk = require("stellar-sdk");

const passphrase = "Test SDF Network ; September 2015";
const url = "https://horizon-testnet.stellar.org";
let server = new sdk.Server(url);

const custodian = sdk.Keypair.fromSecret("SAQLZCQA6AYUXK6JSKVPJ2MZ5K5IIABJOEQIG4RVBHX4PG2KMRKWXCHJ");
const outsider  = sdk.Keypair.fromSecret("SAAY2H7SANIS3JLFBFPLJRTYNLUYH4UTROIKRVFI4FEYV4LDW5Y7HDZ4");

async function preamble() {
  custodianAcc = await server.loadAccount(custodian.publicKey());
  outsiderAcc  = await server.loadAccount(outsider.publicKey());

  customers = ["1", "22", "333", "4444"].map(
    (id) => custodianAcc.createSubaccount(id)
  );

  console.log("Custodian:\n       ", custodian.publicKey());
  console.log("Customers:")
  customers.forEach((customer) => {
    console.log(" " + customer.id().padStart(4, ' ') + ":",
                customer.accountId());
  });
  console.log();
}
```

</CodeExample>

When we run this function, we'll see the similarity in muxed account addresses among the customers, highlighting the fact that they share a public key:

<CodeExample>

```
Custodian:
       GCIHAQVWZH2AB5BB5NP63FBSIREG77LQZZNUVKD2LN2IOCLOT6N72MJN
Customers:
    1: MCIHAQVWZH2AB5BB5NP63FBSIREG77LQZZNUVKD2LN2IOCLOT6N72AAAAAAAAAAAAEDB4
   22: MCIHAQVWZH2AB5BB5NP63FBSIREG77LQZZNUVKD2LN2IOCLOT6N72AAAAAAAAAAAC3IHY
  333: MCIHAQVWZH2AB5BB5NP63FBSIREG77LQZZNUVKD2LN2IOCLOT6N72AAAAAAAAAABJV72I
 4444: MCIHAQVWZH2AB5BB5NP63FBSIREG77LQZZNUVKD2LN2IOCLOT6N72AAAAAAAAAARLQOKK
```

</CodeExample>

<Alert>

  In the following examples, we'll rely on the existence of some helper functions to keep things brief. You can refer to the examples on the [Clawback page](./clawback.mdx#preamble:-issuing-a-clawback-able-asset) for definitions of these helpers.

</Alert>


### External Payments
TODO.


### Internal Payments
As we've mentioned, muxed account actions aren't represented in the Stellar ledger explicitly. When two muxed accounts sharing an underlying Stellar account communicate, it's as if the underlying account is talking to itself. A payment between two such accounts, then, is essentially a no-op.

<CodeExample>

```js
function showBalance(account) {
  console.log(`${acc.accountId().substring(0, 5)}: ${acc.balances[0]}`);
}

function doInternalPayment(source, dest) {
  return server
    .loadAccount(custodian.publicKey())
    .then((accountBeforePayment) => {
      showBalance(accountBeforePayment);

      console.log(`Sending 10 XLM from Customer ${source.id()} to Customer ${dest.id()}.`)

      let payment = sdk.Operation.payment({
        source: source.accountId(),
        destination: dest.accountId(),
        asset: sdk.Asset.native(),
        amount: "10",
        withMuxing: true,
      });

      let tx = buildTx(custodianAcc, custodian, [payment]);
      return server.submitTransaction(tx);
    })
    .then(() => {
      return server.loadAccount(custodian.publicKey()).then(showBalance);
    });
}
```

</CodeExample>

Notice the `withMuxing: true` line: because muxed account support is still experimental, you need to explicitly opt-in to creating operations with muxed properties when you pass them in. If you do not pass this flag, the operations will use the underlying Stellar accounts for those properties, instead. You'll also need to pass it to your `TransactionBuilder` options.

The output should be something like the following:

<CodeExample>

```
GCIHA: 9579.9999800 XLM
Sending 10 XLM from Customer 1 to Customer 22.
GCIHA: 9579.9999700 XLM
```

</CodeExample>

Notice that the account's balance is essentially unchanged. It was, however, charged a fee for essentially doing a no-op. You may want to detect these types of transactions in your application to avoid paying the transaction fee.



### More Examples
As is the case for most protocol-level features, you can find more usage examples and inspiration in the relevant test suite for your favorite SDK. For example, [here](https://github.com/stellar/js-stellar-base/blob/master/test/unit/muxed_account_test.js) are some of the JavaScript test cases.


[supported-ops]: #supported-operations
